<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
 
 <mapper namespace="org.great.mapper.IAdminMapper">
 		<!-- 后台用户登陆 -->
 		<select id="userLogin" parameterType="org.great.bean.AdminBean" resultType="org.great.bean.AdminBean">
			select * from tblbackstage where adminId=#{adminId} and adminPwd=#{adminPwd}
		</select>
		
		<!-- 新增用户（注册） -->
		<insert id="adminRegister" parameterType="org.great.bean.AdminBean">
			insert into tblbackstage values ("自增长",#{adminPwd},#{adminName},#{age},#{background},#{phone},#{graduated},#{sex},#{postId},#{head},#{depaId},#{roleId},#{stateId},#{logicId})
		</insert>
		
		<!-- 后台用户管理列表 -->
		<select id="userAdmin" parameterType="org.great.bean.StaffBean" resultMap="userAdmin">
			select * from(
			select z.*,rownum rn from(
			select a.staffName,a.idNum,a.phone,b.company,c.*,d.guChId from tblstaff a,tblforeground b,tblperguirela c,tblguisetmeal d
			where a.companyId = b.companyId and a.staffId = c.staffId
			<if test="staffName != null and staffName != ''">and a.staffName like concat(concat('%',#{staffName}),'%')</if>
			<if test="phone != null and phone != ''">and a.phone = #{phone}</if>
			<if test="statTime != null and statTime != ''">and c.partYear &gt; = #{statTime}</if>
			<if test="stopTime != null and stopTime != ''">and c.partYear &lt; = #{stopTime}</if>
			<if test="guChId != null and guChId != ''">and d.guChId = #{guChId}</if>
			order by a.staffName)z where rownum &lt; =#{pages}*10 )r where r.rn &gt; =(#{pages}-1)*10+1
		</select>
		<!-- 员工表 -->
		<resultMap type="org.great.bean.StaffBean" id="userAdmin">
			<id property="staffId" column="staffId"/>
			<result property="staffName" column="staffName"/>
			<result property="idNum" column="idNum"/>
			<result property="phone" column="phone"/>
		
		
		<!-- 前台公司表 -->
		<association property="userBean" javaType="org.great.bean.UserBean">
			<result property="company" column="company"/>
		</association>
		
		<!-- 员工导检单关系表 -->
		<association property="perguirelaBean" javaType="org.great.bean.PerguirelaBean">
			<result property="staffId" column="staffId"/>
			<result property="partYear" column="partYear"/>
			<result property="companyId" column="companyId"/>
			<result property="batchNum" column="batchNum"/>
		</association>
		
		<!-- 导检单套餐表 -->
		<association property="guisetmealBean" javaType="org.great.bean.GuisetmealBean">
			<result property="guChId" column="guChId"/>
		</association>
		</resultMap>
		
		<!-- 后台用户总数查询 -->
 	
 </mapper>