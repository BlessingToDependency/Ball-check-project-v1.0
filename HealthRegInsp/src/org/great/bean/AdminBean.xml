<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
 
 <mapper namespace="org.great.mapper.IAdminMapper">
		
 		<!-- 后台用户登陆 -->
 		<select id="adminLogin" parameterType="org.great.bean.AdminBean" resultType="org.great.bean.AdminBean">
			select * from tblbackstage where adminId=#{adminId} and adminPwd=#{adminPwd}
		</select>
		
		<!-- 新增用户（注册） -->
		<insert id="adminRegister" parameterType="org.great.bean.AdminBean">
			insert into tblbackstage values ("自增长",#{adminPwd},#{adminName},#{age},#{background},#{phone},#{graduated},#{sex},#{postId},#{head},#{depaId},#{roleId},#{stateId},#{logicId})
		</insert>
		
		<!-- 根据导检单id找出套餐 -->
		<select id="selectSetmeal" parameterType="java.lang.String" resultType="org.great.bean.SetmealBean">
			select a.* from tblsetmeal a,tblguisetmeal b where a.setmealId = b.setmealId and b.guChId=#{guChId}
		</select>
		
		<!-- 根据用户id查找对应信息 -->
		<select id="userInfo" parameterType="java.lang.String" resultType="org.great.bean.StaffBean">
			select * from tblstaff where staffId = #{staffId}
		</select> 
		
		
		<!-- 公司展示 -->
		<select id="company" parameterType="org.great.bean.UserBean" resultType="org.great.bean.UserBean">
			select * from(
			select z.*,rownum rn from(
			select * from TblForeground order by company
			<where>
				<if test="userBean.company != null"> company=#{company} </if>
				<if test="userBean.address != null"> and address=#{address} </if>
				<if test="userBean.contacts != null"> and contacts=#{contacts} </if>
				<if test="userBean.busNum != null"> and busNum=#{busNum} </if>
			</where>
			)z where rownum &lt; =#{pages}*10 )r where r.rn &gt; =(#{pages}-1)*10+1
		</select>
		
		<!-- 公司总数 -->
		<select id="companyCount" parameterType="org.great.bean.UserBean" resultType="java.lang.Integer">
			select count(*) from TblForeground  
			<where>
				<if test="company != null"> company=#{company} </if>
				<if test="address != null"> and address=#{address} </if>
				<if test="contacts != null"> and contacts=#{contacts} </if>
				<if test="busNum != null"> and busNum=#{busNum} </if>
			</where>
		</select>
		
		
		<!--  后台用户管理列表 -->
		<select id="userAdmin" parameterType="org.great.bean.StaffBean" resultMap="userAdmin">
			select * from(
			select z.*,rownum rn from(
			select a.*,b.company,c.partYear,c.batchNum from tblstaff a,tblforeground b,tblperguirela c
			where a.companyId = b.companyId and a.staffId = c.staffId and a.COMPANYID=#{companyId} 
			<if test="staffName!=null and staffName!='' ">and a.staffName like concat(concat('%',#{staffName}),'%')</if> 
			<if test="phone!=null and phone != ''">and a.phone = #{phone}</if>
			<if test="statTime!=null and statTime != ''">and c.partYear &gt; = #{statTime}</if>
			<if test="stopTime!=null and stopTime != ''">and c.partYear &lt; = #{stopTime}</if>
			order by a.staffName)z where rownum &lt; =#{pages}*10 )r where r.rn &gt; =(#{pages}-1)*10+1
		</select>
		<!-- 员工表 -->
		<resultMap type="org.great.bean.StaffBean" id="userAdmin">
			<id property="staffId" column="STAFFID"/>
			<result property="staffName" column="staffName"/>
			<result property="age" column="age"/>
			<result property="sex" column="sex"/>
			<result property="idNum" column="idNum"/>
			<result property="phone" column="phone"/>
			<result property="companyId" column="companyId"/>
		
		<!-- 前台公司表 -->
		<association property="userBean" javaType="org.great.bean.UserBean" column="companyId">
			<result property="company" column="company"/>
		</association>
		
		<!-- 员工导检单关系表 -->
		<association property="perguirelaBean" javaType="org.great.bean.PerguirelaBean">
			<result property="partYear" column="partYear"/>
			<result property="batchNum" column="batchNum"/>
		</association>
		</resultMap>  
		
		
		<!-- 查询后台用户管理列表总数 -->
		 <select id="userAdminCount" parameterType="org.great.bean.StaffBean" resultType="java.lang.Integer">
			select count(*) from tblstaff a,tblforeground b,tblperguirela c
			where a.companyId = b.companyId and a.staffId = c.staffId and a.COMPANYID=#{companyId}
			<if test="staffName!=null and staffName!='' ">and a.staffName like concat(concat('%',#{staffName}),'%')</if> 
			<if test="phone!=null and phone != ''">and a.phone = #{phone}</if>
			<if test="statTime!=null and statTime != ''">and c.partYear &gt; = #{statTime}</if>
			<if test="stopTime!=null and stopTime != ''">and c.partYear &lt; = #{stopTime}</if>
		</select> 
		
		
 	     <!-- 修改用户密码 -->	   
 	    <update id="updateAdminPws" >
 	      update tblbackstage set adminPwd=#{adminPwd} where adminId=#{adminId}
 	    </update>
 	  
 	      <!-- 修改医生状态 （禁用，启用）-->
 	      <update id="updateDoctorState" parameterType="org.great.bean.AdminBean">
 	         update tblbackstage set stateId=#{stateId} where adminId={adminId}
 	      </update>
 	
 	      <!-- 逻辑删除医生 -->
 	      <update id="logicDeleteDoc" parameterType="org.great.bean.AdminBean">
 	           update  tblbackstage set logicId=#{logicId}  where adminId={adminId}
 	      </update>
 	      
 	      <!-- 后台对医生信息进行修改 -->
 	      <update id="updateDoctorInfo" parameterType="org.great.bean.AdminBean">
 	            update tblbackstage set background=#{background},phone=#{phone},graduated=#{graduated},postId=#{postId},head=#{head},depaId=#{depaId},roleId=#{roleId} where adminId={adminId}
 	      </update>
 	      
 	      <!-- 查询医生信息 -->
 	        <select id="slectDoctorInfo" parameterType="java.lang.Integer" resultMap="adminIn">
 	                select t.*,p.post from tblbackstage  t,PostBean p
 	                
 	                
 	                  where adminId=#{adminId}
 	        </select>
 	        
 	        <resultMap type="org.great.bean.AdminBean" id="adminIn">
	    	<id property="adminId" column="adminId"/>
		   <result property="adminName" column="adminName"/>
		   <result property="age" column="age"/>
		   <result property="background" column="background"/>
	       <result property="phone" column="phone"/>
		   <result property="graduated" column="graduated"/>
		   <result property="background" column="background"/>
		   <result property="sex" column="sex"/>
		   <result property="postId" column="postId"/>
		   <result property="head" column="head"/>
		   <result property="depaId" column="depaId"/>
		   <result property="roleId" column="roleId"/>
		   <result property="stateId" column="stateId"/>
		   <result property="logicId" column="logicId"/>
		<association property="postBean" javaType="org.great.bean.PostBean" >
			<id property="postId" column="postId"/>
			<result property="post" column="post"/>
		</association>
		
	</resultMap>
	<!-- 查询项目 -->
	<select id="selectLitem" resultType="org.great.bean.LitemBean" parameterType="org.great.bean.LitemBean">
		
		select * from ( select  t.*, rownum RN from (
		SELECT * FROM TBLITEM
		<where>
		    <if test="litemBean.item != null and litemBean.item != ''">and item like concat(concat('%',#{litemBean.item}),'%') </if>
			<if test="peakPrice != null and peakPrice != ''">and PRICE &gt;= #{peakPrice} </if>
			<if test="bottomPrice != null and bottomPrice != ''">and PRICE &lt;= #{bottomPrice} </if>
			<if test="litemBean.itemId !=null and litemBean.itemId !=''">and itemId = #{litemBean.itemId}</if>
		</where>
			<!-- <if test="rank = '1'">ORDER BY PRICE</if>
			<if test="rank = '2'">ORDER BY PRICE desc</if> -->
		 )t ) where RN &gt;(#{page}*10-10) and RN &lt;= (#{page}*10)
	</select>
	<!-- 增加项目 -->
	<insert id="addItem" parameterType="org.great.bean.LitemBean">
		insert into TBLITEM VALUES (TBL_ITEM,#{item},#{price},#{introd})
	</insert>
	<!-- 查询项目总数 -->
	<select id="selectLitemSum" resultType="java.lang.Integer" parameterType="org.great.bean.LitemBean">
		select count(*) from TBLITEM
		<where>
		   	 <if test="litemBean.item != null and litemBean.item != ''">and item like concat(concat('%',#{litemBean.item}),'%') </if>
			<if test="peakPrice != null and peakPrice != ''">and PRICE &gt;= #{peakPrice} </if>
			<if test="bottomPrice != null and bottomPrice != ''">and PRICE &lt;= #{bottomPrice} </if>
		</where>
	</select>
	<!-- 查询项目对应的细项信息 -->
	<select id="selectTerm" parameterType="org.great.bean.LitemBean" resultMap="mySelectTerm">
		select a.ITEMID,b.* from tblitemcom a,tblterm b 
		where a.ITEMID = #{itemId} and a.TERMID = b.TERMID
	</select>
	<resultMap type="org.great.bean.TermBean" id="mySelectTerm">
		<id property="termId" column="termId"/>
		<result property="term" column="term"/>
		<result property="measur" column="measur"/>
		<result property="upLimit" column="upLimit"/>
		<result property="downLimit" column="downLimit"/>
		<association property="itemComBean" javaType="org.great.bean.ItemComBean">
		<id property="termId" column="termId"/>
		<result property="termId" column="termId"/>
		</association>
	
	</resultMap>
	
	

 </mapper>