<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
 
 <mapper namespace="org.great.bean.TotalBean">
   
  <!--用户报告  -->
 	<select id="showReport" parameterMap="java.lang.String" resultType="org.great.bean.TotalBean">
 		SELECT * FROM tbltotal where  GUCHID =#{guChId}	
 	</select>
 	
 	<!--展示有开单体检的公司  -->
 	<select id="showCompany" parameterType="java.lang.String"  resultMap="company" >
 		select d.*,rownum from
		(select c.* ,rownum rn from
		(select a.ordertime ,b.* from  tblbill  a,  TBLFOREGROUND b where a.companyId = b.companyId 
		<where>
			<if test="null != company and ''!=company " >
				and  b.company  like concat(concat('%',#{company}),'%')
			</if>
		</where>
		 order by a.ordertime desc)c where rownum &lt;=(#{currentPage} * #{pagecount}))d where rn&gt;=((#{currentPage}-1)*#{pagecount}+1)	
 	</select>
 	
 	<resultMap type="org.great.bean.BillBean" id="company">
 		<result column="billId" property="billId"/>
 		<result column="companyId" property="companyId"/>
 		<result column="ordNum" property="ordNum"/>
 		<result column="actNum" property="actNum"/>
 		<result column="setmealId" property="setmealId"/>
 		<result column="actCharge" property="actCharge"/>
 		<result column="orderTime" property="orderTime"/>	
 	<association property="userBean">
 		<id column="companyId" property="companyId"/>
 		<result column="company" property="company"/>	
 	</association>	
 	</resultMap>
 	
 	<select id="countPage" resultType="java.lang.Integer" parameterType="java.lang.Integer">
 		select count(*) from
		(select a.ordertime ,b.* from  tblbill  a,  TBLFOREGROUND b where a.companyId = b.companyId  
		<where>
				<if test="null != company and ''!=company">
					and  b.company  like concat(concat('%',#{company}),'%')
				</if>			
		</where>		
	    order by a.ordertime desc)
 	
 	</select>
 	
 	
 </mapper>
 